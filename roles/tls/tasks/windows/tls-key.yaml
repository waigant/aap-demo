---

- name: Windows TLS Key - Ensure tls directory exists
  ansible.windows.win_file:
    path: "{{ windows_tls_dir }}"
    state: directory

- name: Windows TLS Key - genrsa private key
  environment:
    PATH: "{{ windows_openssl_apps_dir }}\\x64\\bin"
  ansible.windows.win_command:
    chdir: "{{ windows_tls_dir }}"
    cmd: openssl genrsa -out private.key 2048
  changed_when: false

- name: Windows TLS Key - genrsa pub key
  environment:
    PATH: "{{ windows_openssl_apps_dir }}\\x64\\bin"
  ansible.windows.win_command:
    chdir: "{{ windows_tls_dir }}"
    cmd: openssl rsa -in private.key -pubout -out pub.pem
  changed_when: false

- name: Windows TLS Key - genrsa pkcs8 key
  environment:
    PATH: "{{ windows_openssl_apps_dir }}\\x64\\bin"
  ansible.windows.win_command:
    chdir: "{{ windows_tls_dir }}"
    cmd: openssl pkcs8 -topk8 -inform PEM -outform PEM -nocrypt -in private.key -out pkcs8.key
  changed_when: false
